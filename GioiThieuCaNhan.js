// const photos = document.querySelectorAll(".pic"); // Ch·ªçn ƒë√∫ng c√°c ph·∫ßn t·ª≠ ·∫£nh
// const title = document.querySelectorAll(".favorite-title");
// const hobbiesContainer = document.querySelector(".hobbies-container");

// // Hi·ªÉn th·ªã ·∫£nh l·∫ßn l∆∞·ª£t khi cu·ªôn t·ªõi
// const showPhotosSequentially = (elements, index = 0) => {
//   if (index >= elements.length) return;
//   elements[index].classList.add("show");
//   setTimeout(() => {
//     showPhotosSequentially(elements, index + 1);
//   }, 300);
// };

// const showTextAboutme = (elements, index = 0) => {
//   if (index >= elements.length) return;
//   elements[index].classList.add("show");
//   setTimeout(() => {
//     showTextAboutme(elements, index + 1);
//   }, 300);
// };

// // T·∫°o Intersection Observer cho t·ª´ng ·∫£nh v·ªõi hi·ªáu ·ª©ng m∆∞·ª£t m√† h∆°n
// const createPhotoObserver = () => {
//   const photoObserver = new IntersectionObserver(
//     (entries) => {
//       entries.forEach((entry, index) => {
//         if (entry.isIntersecting) {
//           const photo = entry.target;
//           // Th√™m ƒë·ªô tr·ªÖ tƒÉng d·∫ßn cho m·ªói ·∫£nh ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng l·∫ßn l∆∞·ª£t
//           const delay = 150 * (index % 3); // M·ªói c·ªôt c√≥ ƒë·ªô tr·ªÖ kh√°c nhau
//           setTimeout(() => {
//             photo.classList.add("show");
//           }, delay);
//           photoObserver.unobserve(photo);
//         }
//       });
//     },
//     { threshold: 0.15, rootMargin: "0px 0px -50px 0px" } // TƒÉng ng∆∞·ª°ng v√† th√™m rootMargin
//   );

//   // Theo d√µi t·∫•t c·∫£ c√°c ·∫£nh
//   photos.forEach((photo) => {
//     photoObserver.observe(photo);
//   });
// };

// // Khi .my_favorite cu·ªôn v√†o m√†n h√¨nh
// const sectionObserver = new IntersectionObserver(
//   (entries) => {
//     entries.forEach((entry) => {
//       if (entry.isIntersecting) {
//         showTextAboutme(title);
//         // Th√™m hi·ªáu ·ª©ng cho hobbies-container v·ªõi ƒë·ªô tr·ªÖ
//         setTimeout(() => {
//           hobbiesContainer.classList.add("show");
//         }, 300);
//         createPhotoObserver();
//         sectionObserver.disconnect();
//       }
//     });
//   },
//   { threshold: 0.1 }
// );

// sectionObserver.observe(document.querySelector(".my_favorite")); // B·∫Øt ƒë·∫ßu theo d√µi .my_favorite
const photos = document.querySelectorAll(".pic"); // Ch·ªçn ƒë√∫ng c√°c ph·∫ßn t·ª≠ ·∫£nh
const title = document.querySelectorAll(".favorite-title");
const hobbiesContainer = document.querySelector(".hobbies-container");

// Hi·ªÉn th·ªã t·ª´ng ph·∫ßn t·ª≠ l·∫ßn l∆∞·ª£t
const showSequentially = (elements, index = 0, delay = 300, callback) => {
  if (index >= elements.length) {
    if (callback) callback();
    return;
  }
  elements[index].classList.add("show");
  setTimeout(() => {
    showSequentially(elements, index + 1, delay, callback);
  }, delay);
};

// Hi·ªÉn th·ªã ·∫£nh l·∫ßn l∆∞·ª£t
const showPhotosSequentially = (elements, index = 0) => {
  if (index >= elements.length) return;
  elements[index].classList.add("show");
  setTimeout(() => {
    showPhotosSequentially(elements, index + 1);
  }, 300);
};

// Intersection Observer cho ·∫£nh
const createPhotoObserver = () => {
  const photoObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          photoObserver.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.15, rootMargin: "0px 0px -50px 0px" }
  );

  photos.forEach((photo) => photoObserver.observe(photo));

  // Sau khi ƒë√£ quan s√°t, b·∫Øt ƒë·∫ßu hi·ªán tu·∫ßn t·ª±
  showPhotosSequentially(photos);
};

// Khi .my_favorite cu·ªôn v√†o m√†n h√¨nh
const sectionObserver = new IntersectionObserver(
  (entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        // B1: Hi·ªán title
        showSequentially(title, 0, 300, () => {
          // B2: Sau khi title xong th√¨ hi·ªán hobbies-container
          hobbiesContainer.classList.add("show");

          // B3: Delay m·ªôt ch√∫t r·ªìi m·ªõi hi·ªán ·∫£nh
          setTimeout(() => {
            createPhotoObserver();
          }, 400);
        });

        sectionObserver.disconnect();
      }
    });
  },
  { threshold: 0.5 }
);

sectionObserver.observe(document.querySelector(".my_favorite"));

//H√†m cu·ªôn t·ªõi section
function scrollToSection(id) {
  const taget = document.getElementById(id);
  if (!taget) return;
  const chieucaoHeader = 66;
  const khoachcachSectionvaDinh = taget.getBoundingClientRect().top;
  const toadocuontoi =
    khoachcachSectionvaDinh + window.pageYOffset - chieucaoHeader;
  window.scrollTo({
    top: toadocuontoi,
    behavior: "smooth",
  });
}
// Hi·ªáu ·ª©ng chu·ªôt
const cursor = document.querySelector(".cursor");
let lastHeartTime = 0; // t·∫°o bi·∫øn ƒë·ªÉ l∆∞u th·ªùi gian c·ªßa l·∫ßn cu·ªëi c√πng chu·ªôt r∆°i tr√°i tim
document.addEventListener("mousemove", (e) => {
  // s·ª± ki·ªán di chuy·ªÉn chu·ªôt
  cursor.style.left = `${e.pageX}px`; // ƒë·∫∑t v·ªã tr√≠ c·ªßa chu·ªôt
  cursor.style.top = `${e.pageY}px`; // ƒë·∫∑t v·ªã tr√≠ c·ªßa chu·ªôt

  const currentTime = Date.now(); // l·∫•y th·ªùi gian hi·ªán t·∫°i
  if (currentTime - lastHeartTime > 150) {
    // n·∫øu th·ªùi gian hi·ªán t·∫°i - th·ªùi gian l·∫ßn cu·ªëi c√πng chu·ªôt r∆°i tr√°i tim l·ªõn h∆°n 150 gi√¢y
    const heart = document.createElement("div"); // t·∫°o ph·∫ßn t·ª≠ div
    heart.className = "heart"; // ƒë·∫∑t t√™n class cho div
    heart.style.left = `${e.pageX}px`; // ƒë·∫∑t v·ªã tr√≠ c·ªßa tr√°i tim
    heart.style.top = `${e.pageY}px`; // ƒë·∫∑t v·ªã tr√≠ c·ªßa tr√°i tim
    document.body.appendChild(heart); // th√™m tr√°i tim v√†o body
    setTimeout(() => heart.remove(), 2000); // x√≥a tr√°i tim sau 2 gi√¢y
    lastHeartTime = currentTime; // c·∫≠p nh·∫≠t th·ªùi gian c·ªßa l·∫ßn cu·ªëi c√πng chu·ªôt r∆°i tr√°i tim
    heart.innerHTML = "‚ù§Ô∏è"; // th√™m bi·ªÉu t∆∞·ª£ng tr√°i tim v√†o ph·∫ßn t·ª≠
    heart.style.fontSize = "16px"; // ƒë·∫∑t k√≠ch th∆∞·ªõc c·ªßa tr√°i tim
    heart.style.color = "white"; // ƒë·∫∑t m√†u s·∫Øc c·ªßa tr√°i tim
  }
});
document.addEventListener("mousedown", () => {
  cursor.style.width = "30px";
  cursor.style.height = "30px";
});
document.addEventListener("mouseup", () => {
  cursor.style.width = "20px";
  cursor.style.height = "20px";
});

//H√†m vi·∫øt x√≥a ch·ªØ
new TypeIt("#type-it", {
  speed: 100,
  deleteSpeed: 50,
  loop: true,
  cursorSpeed: 800,
})
  .type("üíª BackEnd Developer")
  .pause(1000)
  .delete()
  .type("27 ƒêi·ªán Bi√™n =))")
  .pause(1000)
  .delete()
  .type("Uneti-er :v")
  .pause(1000)
  .delete()
  .go();
//H√†m click v√†o LoGo
document.addEventListener("DOMContentLoaded", function () {
  const logo = document.querySelector(".Logo img");
  logo.addEventListener("click", function () {
    // G·ª° class c≈© n·∫øu c√≥ ƒë·ªÉ t√°i k√≠ch ho·∫°t animation
    logo.classList.remove("jello-horizontal");

    // Trigger l·∫°i hi·ªáu ·ª©ng b·∫±ng c√°ch d√πng setTimeout
    void logo.offsetWidth; // force reflow
    logo.classList.add("jello-horizontal");
  });
});
//H√ÄM T√î M√ÄU MENU ·ªû SECTION T∆Ø∆†NG ·ª®NG
const sections = document.querySelectorAll("section");
const navLinks = document.querySelectorAll(".nav-link");

window.addEventListener("scroll", () => {
  let current = "";

  sections.forEach((section) => {
    const sectionTop = section.offsetTop;
    const sectionHeight = section.offsetHeight;
    if (window.scrollY >= sectionTop - sectionHeight / 3) {
      current = section.getAttribute("id");
    }
  });

  navLinks.forEach((link) => {
    link.classList.remove("active");
    if (link.dataset.target === current) {
      link.classList.add("active");
    }
  });
});

// ƒêƒÉng k√Ω plugin ScrollTrigger
gsap.registerPlugin(ScrollTrigger);

// ƒê·ª£i DOM load xong
document.addEventListener("DOMContentLoaded", function () {
  // Hi·ªáu ·ª©ng fade in cho header
  gsap.fromTo(
    "header",
    {
      opacity: 0,
      y: -50,
    },
    {
      opacity: 1,
      y: 0,
      duration: 1,
      ease: "power2.out",
      delay: 0.2,
    }
  );

  // Hi·ªáu ·ª©ng fade in cho logo trong intro section
  gsap.fromTo(
    ".Logo img",
    {
      opacity: 0,
      scale: 0.8,
      rotation: -10,
    },
    {
      opacity: 1,
      scale: 1,
      rotation: 0,
      duration: 1.2,
      ease: "back.out(1.7)",
      delay: 0.5,
    }
  );

  // Hi·ªáu ·ª©ng fade in cho ti√™u ƒë·ªÅ ch√≠nh
  gsap.fromTo(
    ".TieuDe h1",
    {
      opacity: 0,
      x: -100,
    },
    {
      opacity: 1,
      x: 0,
      duration: 0.8,
      ease: "power2.out",
      delay: 0.7,
    }
  );

  gsap.fromTo(
    ".TieuDe h3",
    {
      opacity: 0,
      x: -80,
    },
    {
      opacity: 1,
      x: 0,
      duration: 0.8,
      ease: "power2.out",
      delay: 0.9,
    }
  );

  gsap.fromTo(
    ".TieuDe h4",
    {
      opacity: 0,
      x: -60,
    },
    {
      opacity: 1,
      x: 0,
      duration: 0.8,
      ease: "power2.out",
      delay: 1.1,
    }
  );

  // Hi·ªáu ·ª©ng fade in cho paragraphs
  gsap.fromTo(
    ".TieuDe p",
    {
      opacity: 0,
      y: 30,
    },
    {
      opacity: 1,
      y: 0,
      duration: 0.6,
      ease: "power2.out",
      delay: 1.3,
      stagger: 0.2,
    }
  );

  // Hi·ªáu ·ª©ng fade in cho c√°c n√∫t contact
  gsap.fromTo(
    ".KhoiNut .button",
    {
      opacity: 0,
      x: 100,
      scale: 0.8,
    },
    {
      opacity: 1,
      x: 0,
      scale: 1,
      duration: 0.6,
      ease: "back.out(1.7)",
      delay: 1.5,
      stagger: 0.1,
    }
  );

  // Hi·ªáu ·ª©ng fade in cho About Me section khi scroll
  gsap.fromTo(
    ".favorite-title h2",
    {
      opacity: 0,
      y: 50,
    },
    {
      opacity: 1,
      y: 0,
      duration: 1,
      ease: "power2.out",
      scrollTrigger: {
        trigger: ".my_favorite",
        start: "top 80%",
        end: "top 30%",
        toggleActions: "play none none reverse",
      },
    }
  );

  // Hi·ªáu ·ª©ng fade in cho ph·∫ßn About Me content
  gsap.fromTo(
    ".about-me-section",
    {
      opacity: 0,
      x: -100,
    },
    {
      opacity: 1,
      x: 0,
      duration: 1,
      ease: "power2.out",
      scrollTrigger: {
        trigger: ".about-me-section",
        start: "top 80%",
        end: "top 30%",
        toggleActions: "play none none reverse",
      },
    }
  );

  // Hi·ªáu ·ª©ng fade in cho t√™n v√† bio
  gsap.fromTo(
    ".name",
    {
      opacity: 0,
      y: 30,
    },
    {
      opacity: 1,
      y: 0,
      duration: 0.8,
      ease: "power2.out",
      scrollTrigger: {
        trigger: ".DongMoTa",
        start: "top 75%",
        toggleActions: "play none none reverse",
      },
    }
  );

  gsap.fromTo(
    ".bio",
    {
      opacity: 0,
      y: 40,
    },
    {
      opacity: 1,
      y: 0,
      duration: 1,
      ease: "power2.out",
      scrollTrigger: {
        trigger: ".DongMoTa",
        start: "top 70%",
        toggleActions: "play none none reverse",
      },
    }
  );

  // Hi·ªáu ·ª©ng fade in cho c√°c n√∫t CV
  gsap.fromTo(
    ".NutCV button",
    {
      opacity: 0,
      y: 30,
      scale: 0.9,
    },
    {
      opacity: 1,
      y: 0,
      scale: 1,
      duration: 0.6,
      ease: "back.out(1.7)",
      stagger: 0.2,
      scrollTrigger: {
        trigger: ".NutCV",
        start: "top 80%",
        toggleActions: "play none none reverse",
      },
    }
  );

  // Hi·ªáu ·ª©ng fade in cho khung kinh nghi·ªám
  gsap.fromTo(
    ".KhungKinhNghiem .Khung",
    {
      opacity: 0,
      y: 50,
      scale: 0.8,
    },
    {
      opacity: 1,
      y: 0,
      scale: 1,
      duration: 0.8,
      ease: "back.out(1.7)",
      stagger: 0.2,
      scrollTrigger: {
        trigger: ".KhungKinhNghiem",
        start: "top 80%",
        toggleActions: "play none none reverse",
      },
    }
  );

  // Hi·ªáu ·ª©ng fade in cho ph·∫ßn s·ªü th√≠ch
  gsap.fromTo(
    ".interests-container",
    {
      opacity: 0,
      x: 100,
    },
    {
      opacity: 1,
      x: 0,
      duration: 1,
      ease: "power2.out",
      scrollTrigger: {
        trigger: ".interests-container",
        start: "top 80%",
        toggleActions: "play none none reverse",
      },
    }
  );

  // Hi·ªáu ·ª©ng fade in cho ti√™u ƒë·ªÅ s·ªü th√≠ch
  gsap.fromTo(
    ".interests-title",
    {
      opacity: 0,
      y: 30,
    },
    {
      opacity: 1,
      y: 0,
      duration: 0.8,
      ease: "power2.out",
      scrollTrigger: {
        trigger: ".interests-section",
        start: "top 75%",
        toggleActions: "play none none reverse",
      },
    }
  );

  // Hi·ªáu ·ª©ng fade in cho c√°c card s·ªü th√≠ch
  gsap.fromTo(
    ".hobbies-container .card",
    {
      opacity: 0,
      y: 60,
      rotationX: 15,
    },
    {
      opacity: 1,
      y: 0,
      rotationX: 0,
      duration: 0.8,
      ease: "power2.out",
      stagger: 0.3,
      scrollTrigger: {
        trigger: ".hobbies-container",
        start: "top 80%",
        toggleActions: "play none none reverse",
      },
    }
  );

  // Hi·ªáu ·ª©ng hover cho c√°c card (t√πy ch·ªçn)
  const cards = document.querySelectorAll(".card");
  cards.forEach((card) => {
    card.addEventListener("mouseenter", () => {
      gsap.to(card, {
        scale: 1.05,
        y: -10,
        duration: 0.3,
        ease: "power2.out",
      });
    });

    card.addEventListener("mouseleave", () => {
      gsap.to(card, {
        scale: 1,
        y: 0,
        duration: 0.3,
        ease: "power2.out",
      });
    });
  });

  // Hi·ªáu ·ª©ng fade in cho cursor (n·∫øu c√≥)
  if (document.querySelector(".cursor")) {
    gsap.set(".cursor", {
      opacity: 0,
      scale: 0,
    });

    gsap.to(".cursor", {
      opacity: 1,
      scale: 1,
      duration: 0.5,
      ease: "power2.out",
      delay: 2,
    });
  }

  // Animation t·ªïng th·ªÉ cho to√†n b·ªô trang khi load
  gsap.fromTo(
    "body",
    {
      opacity: 0,
    },
    {
      opacity: 1,
      duration: 0.5,
      ease: "power2.out",
    }
  );

  // Refresh ScrollTrigger sau khi t·∫•t c·∫£ animation ƒë∆∞·ª£c thi·∫øt l·∫≠p
  ScrollTrigger.refresh();
});

// H√†m ƒë·ªÉ l√†m m·ªõi ScrollTrigger khi c·∫ßn thi·∫øt
function refreshScrollTrigger() {
  ScrollTrigger.refresh();
}

// G·ªçi refresh khi window resize
window.addEventListener("resize", () => {
  ScrollTrigger.refresh();
});
